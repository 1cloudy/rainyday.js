<html>
	<head>
		<style media="screen" type="text/css">
			img { display: none; }
			body { overflow: hidden; }
			#canvas { position: absolute; top: 0px; left: 0px; }
			#sound { position: absolute; width: 30%; height: 30%; overflow-y: auto; margin-left: 35%; -moz-border-radius: 15px; border-radius: 15px; background-color: #C4C4C4; opacity: 0.3; margin-top: 5%; }
			.video { position: absolute; width: 90%; height: 80%; margin-left: 5%; margin-top: 5%; }
		</style>
		<script src="rainyday.js" type="text/javascript"></script>
		<script type="text/javascript">
			function getURLParameter(name) {
    			return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
			}

 			function demo() {
				
				var testCanvas = document.createElement('canvas');
				testCanvas.width = 960;
				testCanvas.height = 640;

				testCanvas.id = 'testCanvas';
				testCanvas.style.display = "none";

				var raf = window.requestAnimationFrame ||
						window.webkitRequestAnimationFrame ||
						window.mozRequestAnimationFrame ||
							function(callback) {
								window.setTimeout(callback, 1000 / 30);
							};

					raf(function drawThing(){
						testCanvas.getContext('2d').drawImage(video,0,0,960,640);
						if(window.engine){
							engine.prepareBackground(960,640);
							engine.prepareReflections();
							engine.stoppedDrops.forEach(function(x){
								x.draw()
							});
						}
						raf(drawThing);
					});

				document.body.appendChild(testCanvas);

				window.setupEngine = function(){
	    			var engine = new RainyDay(document.getElementById('canvas'),testCanvas, 960, 640, 1, getURLParameter("blur") || 20);
					window.engine = engine;

					var preset = getURLParameter("preset") || 3;
					if (preset == 1) {
						engine.gravity = engine.GRAVITY_NON_LINEAR;
						engine.trail = engine.TRAIL_DROPS;
						engine.rain([ engine.preset(3, 3, 0.88), engine.preset(5, 5, 0.9), engine.preset(6, 2, 1) ], 100);
					} else if (preset == 2) {
						engine.gravity = engine.GRAVITY_NON_LINEAR;
							engine.trail = engine.TRAIL_DROPS;
							engine.VARIABLE_GRAVITY_ANGLE = Math.PI / 8;
						engine.rain([ engine.preset(0, 2, 0.5), engine.preset(4, 4, 1) ], 50);
					} else if (preset == 3) {
						// engine.gravity = engine.GRAVITY_NON_LINEAR;
						engine.reflection = engine.REFLECTION_MINIATURE;
							engine.trail = engine.TRAIL_DROPS;
							engine.VARIABLE_GRAVITY_ANGLE = Math.PI / 8;
						engine.rain([ engine.preset(0, 2, 0.5), engine.preset(4, 4, 1) ], 50);
					}
				}
				var video = document.getElementById('video');
				video.play();
 			}
		</script>
	</head>
	<body onload="demo();">
		<div id="sound" style="z-index: -1;"></div>
		<img id="background" src="bg_1.jpg" style="display:none;"/>
		<video id="video" src="movie.ogv" controls="true"></video>
		<div id="cholder">
			<canvas id="canvas"></canvas>
		</div>
	</body>
</html>
